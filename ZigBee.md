
IEEE 802.15.4


内容分为两部分，分别是**其他**和**计算**

# 其他


| **角色**     | **Coordinator（协调器）** | **Router（路由器）**       | **End Device（终端设备）** |
|--------------|---------------------------|----------------------------|----------------------------|
| **功能**     | 负责网络的初始化和管理，分配地址，维护路由表 | 转发数据包，扩展网络覆盖范围，参与路由功能 | 仅负责与父节点通信，不参与路由功能 |
| **通信能力** | 能与所有设备通信           | 能与协调器、其他路由器及终端通信 | 只能与父节点通信             |
| **电源需求** | 通常需要持续供电           | 需要持续供电                | 支持低功耗模式，适合电池供电 |
| **角色数量** | 网络中仅有一个             | 网络中可以有多个            | 网络中可以有多个            |
| **应用场景** | 网络的中心节点             | 用于扩展网络覆盖范围        | 低功耗传感器、终端设备       |

![[Pasted image 20250107171022.png]]


长地址64位，短地址16位

2.4G数据速率为250kbps

![[Pasted image 20250107171212.png]]

信标使能与非信标使能见ppt


![[Pasted image 20250107221650.png]]

![[Pasted image 20250107221657.png]]



---

# 计算

## CSMA/CA 载波监听多址接入冲突避免

![[Pasted image 20250107172135.png]]

信标使能模式CSMA/CA有时隙，非信标使能无时隙

**CCA：用于检测信道是否空闲的过程**

![[Pasted image 20250107172433.png]]

- NB：默认1，每次碰撞+1，超过某值说明传输失败
- CW：至少检测的次数，每次检测无碰撞（空闲）后-1，直到CW是0后停止检测，才可以发送数据帧
- BE：分散退避时间

特殊省电模式：
- 竞争仅限于前 6 个时隙
- 退避指数（BE）的范围限制在0~2


*流程图解释*
**信标使能，有时隙**

![[Pasted image 20250107173224.png]]

如图：
- 初始化
	默认NB=0，CW=2，意味着需要检测两次空闲
	检查是否启用 Battery Life Extension，决定退避指数（BE）的范围
- 碰撞检测
	先进入退避时间，时间结束后CCA
	如果信道忙，退避次数增加（NB），重新退避
	如果信道空闲且满足多次检测（CW=0），则进入数据传输
	注意，**如果检测到信道忙，那么CW将立刻重置**也就是必须连续CW次检测到空闲才可以
![[Pasted image 20250107173441.png]]


**非信标使能，无时隙**
![[Pasted image 20250107174558.png|850]]

**此时CW是摆设**

![[Pasted image 20250107174626.png|850]]



这一章后PPT中的三张图对应三种极端情况，略微解释了为什么需要多次CCA（避免碰撞ACK）



## 性能计算

![[Pasted image 20250107221542.png]]

![[Pasted image 20250107221549.png]]

如果仅仅指定了源地址，那么最大数据载荷就是118(127-5-4)



**关键计算**

$\displaystyle \large 1symbol=16μs$
backoffperiod 在IEEE 802.15.4 中的默认值为20 个symbols
CCA默认占8符号周期
最终要计算一段数据传输出去*消耗的时间*和*吞吐率* $\displaystyle \large  \frac{有效载荷数据大小}{消耗时间}$


其中包括下面几部分：

1. 信道访问时间，即传输前的准备时间，由CSMA/CA产生
	BE默认为3
	`InitialbackoffPeriod`:退避初始周期
	`aUnitBackoffPeriod`:退避单位周期
	`CCA`:信道清除评估时间
$$
最长访问时间=InitialbackoffPeriod+CCA=(2^{BE}-1)*aUnitBackoffPeriod+CCA=7*(20*16)μs+(8*16)μs=7*320μs+128μs=2.368ms
$$
2. 有效载荷传输时间，见物理帧结构
	传输速率(2.4GHz):250kbps
	`aMaxPHYPacketSize` = 127B
$$
\large 数据帧传输时间= \frac{(aMaxPHYPacketSize+SHR+PHR)*8}{250*10^3}=\frac{(127+5+1)*8}{250*10^3}=4.256ms
$$
3. 确认帧(ACK)传输时间
	*ACK不使用CSMA/CA*
$$
\large ACK时间=\frac{(ACK帧字节+SHR+PHR)*8}{250*10^3}=\frac{(2+1+2+5+1)*8}{250*10^3}=0.352ms
$$
4. 从发送模式切换到接收模式的时间
	`aTurnaroundTime`
$$
\large aTurnaroundTime=120.192ms 
$$
5. 重试时间
	未收到ACK时，需要等待`macAckWaitDuration`后重试